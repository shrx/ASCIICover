#!/bin/bash

#released under GPL v3
#ğ“ ğ“¶ğ“²ğ“µğ“µğ“²ğ“¸ğ“· ğ“¹ğ“²ğ“®ğ“¼ !P3141593qY
#v1.1
#6. 2. 2012
#dependencies: libcaca

function ascii {
	path=$(mpc -f %file% current)
	lib1=$(grep -a -m 1 music_directory ~/.mpdconf)
	lib2=$(echo ${lib1%\"*})
	librarypath=$(echo ${lib2#*\"})
	fullpath=$(echo $librarypath"/"$path)
	dirpath=$(dirname "$fullpath")
	folderpath=$(echo $dirpath"/folder.jpg")
	lines=$(tput lines)
	height=$(echo "$lines-1"|bc)
	width=$(echo "$height*1.87"|bc)
	if [ -f "$folderpath" ]; then
		img2txt -H $height -W $width --dither none "$folderpath"
	else
		clear
	fi
}

QQUIT="no"
read -s -t 1 -n 1 QQUIT
terminal=$(echo $TERM_PROGRAM)
if [ "$terminal" == "iTerm.app" ]; then
	osascript -e 'tell app "iterm" to set the bounds of the first window to {140, 120, 140+400-12, 120+400+20}'
else
	printf "\\E[4;388;423t"
fi
ascii
while [ "$QQUIT" != "q" ]; do
	ascii
	sleep 1
	read -s -t 1 -n 1 QQUIT
done
clear
exit